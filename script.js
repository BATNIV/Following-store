// script.js - XFollowDZ front-end (localStorage based)
// Config
const ADMIN_WHATSAPP = '213655643510'; // أدمن واتساب (بدون +)
const BINANCE_ID = '782102873'; // Binance pay ID
const SERVICES = [
  {id:'fb_follow', name:'متابعين فيسبوك', pricePer100:0.10, unitText:'لكل 100'},
  {id:'fb_like', name:'لايكات فيسبوك', pricePer100:0.05, unitText:'لكل 100'},
  {id:'ig_views', name:'مشاهدات إنستغرام', pricePer100:0.08, unitText:'لكل 100'},
  {id:'tt_views', name:'مشاهدات TikTok', pricePer100:0.12, unitText:'لكل 100'},
  {id:'tg_members', name:'أعضاء تيلغرام', pricePerUnit:0.10, unitText:'لكل عضو'},
  {id:'yt_views', name:'مشاهدات يوتيوب', pricePer100:0.12, unitText:'لكل 100'}
];
function $(id){return document.getElementById(id);}function fmt(n){return parseFloat(n||0).toFixed(2);}function registerUser(){const u=$('regUser').value.trim();const p=$('regPass').value.trim();const phone=$('regPhone').value.trim();if(!u||!p) return alert('املأ كل الحقول');localStorage.setItem('user_'+u, JSON.stringify({user:u,pass:p,phone:phone}));if(localStorage.getItem('balance_'+u)===null) localStorage.setItem('balance_'+u,'0');alert('تم التسجيل! سجل الدخول الآن.');$('regUser').value='';$('regPass').value='';$('regPhone').value='';}function loginUser(){const u=$('loginUser').value.trim();const p=$('loginPass').value.trim();const raw=localStorage.getItem('user_'+u);if(!raw) return alert('المستخدم غير موجود');const obj=JSON.parse(raw);if(obj.pass!==p) return alert('كلمة المرور خاطئة');localStorage.setItem('fast10_session',u);showSection('order');updateBalancesUI();}function logout(){localStorage.removeItem('fast10_session');location.reload();}function currentUser(){return localStorage.getItem('fast10_session')||null;}function getUserBalance(u){return parseFloat(localStorage.getItem('balance_'+u)||'0')||0;}function setUserBalance(u,v){localStorage.setItem('balance_'+u,fmt(v));}function showSection(name){const map={order:'orderSection',wallet:'walletSection',orders:'ordersSection',profile:'profileSection'};['authSection','orderSection','walletSection','ordersSection','profileSection','adminLoginSection'].forEach(id=>{const el=$(id); if(el) el.style.display='none';});if(name==='order'&&!currentUser()){alert('سجل الدخول أولاً');return;}const target=map[name]||'authSection';$(target).style.display='block';if(name==='order') renderServices();if(name==='wallet') renderTopups();if(name==='orders') renderOrders();if(name==='profile') renderProfile();updateBalancesUI();}function renderServices(){const container=$('servicesContainer');container.innerHTML='';SERVICES.forEach(s=>{const div=document.createElement('div');div.className='card';div.setAttribute('data-id',s.id);div.setAttribute('data-price',s.pricePer100||s.pricePerUnit||0);div.innerHTML=`<h3>${s.name}</h3><div class="meta"><span class="muted">${s.pricePer100? s.pricePer100+'$ '+s.unitText : s.pricePerUnit+'$ '+s.unitText}</span></div><div class="row"><select class="quantitySelect"><option value="0">اختر العدد</option><option value="100">100</option><option value="500">500</option><option value="1000">1000</option><option value="5000">5000</option></select></div><div style="display:flex;justify-content:space-between;align-items:center"><div class="muted">المجموع</div><div class="total">0$</div></div>`;container.appendChild(div);});document.querySelectorAll('.quantitySelect').forEach(s=>s.onchange=updateAllInvoice);}function updateAllInvoice(){let total=0;const services=[];const quantities=[];document.querySelectorAll('.card').forEach(card=>{const id=card.getAttribute('data-id');const price=parseFloat(card.getAttribute('data-price'))||0;const qty=parseInt(card.querySelector('.quantitySelect').value)||0;if(qty>0){const svc=SERVICES.find(x=>x.id===id);let svcTotal=svc.pricePer100? price*(qty/100) : price*qty;total+=svcTotal;services.push(svc.name);quantities.push(qty);card.querySelector('.total').innerText=svcTotal.toFixed(2)+'$';}else card.querySelector('.total').innerText='0$';});if(total>0){$('invoice').style.display='block';$('invService').innerText=services.join(', ');$('invQuantity').innerText=quantities.join(', ');$('invTotal').innerText=fmt(total);}else $('invoice').style.display='none';return total;}function placeOrder(){const total=updateAllInvoice();if(total<=0) return alert('اختر خدمة واحدة على الأقل');const user=currentUser();if(!user) return alert('سجل الدخول');let balance=getUserBalance(user);if(balance<total) return alert('رصيد غير كاف');setUserBalance(user,balance-total);const order={id:'OD-'+Date.now(),user:user,service:$('invService').innerText,qty:$('invQuantity').innerText,total:fmt(total),status:'في انتظار'};const orders=JSON.parse(localStorage.getItem('fast10Orders')||'[]');orders.push(order);localStorage.setItem('fast10Orders',JSON.stringify(orders));const adminMsg=`📩 طلب جديد\n🔖 رقم الطلب: ${order.id}\n👤 المستخدم: ${order.user}\n⚡ الخدمة: ${order.service}\n📦 الكمية: ${order.qty}\n💵 الإجمالي: ${order.total}$`;window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(adminMsg)}`,'_blank');const userObj=JSON.parse(localStorage.getItem('user_'+user)||'{}');if(userObj.phone) window.open(`https://wa.me/${userObj.phone}?text=${encodeURIComponent(`✅ شكراً على طلبك\n🔖 رقم الطلب: ${order.id}\n🔹 الخدمة: ${order.service}\n🔹 الكمية: ${order.qty}\n🔹 المجموع: ${order.total}$\nسوف نتواصل معك قريبا.`)}`,'_blank');alert('تم إنشاء الطلب وخصم المبلغ من رصيدك. تم إشعار الأدمن.');renderOrders();updateBalancesUI();}function updatePayInfo(){const method=$('topupMethod').value;$('paymentBox').style.display=method?'block':'none';if(method==='binance') $('payID').innerText=BINANCE_ID;else if(method==='payeer') $('payID').innerText='P1234567';else if(method==='poste') $('payID').innerText='C.C.P 0012354789';$('topupOrderID').innerText='SH-'+Math.floor(Math.random()*900000+100000);}function copyPayID(){navigator.clipboard.writeText($('payID').innerText);alert('تم نسخ رقم الدفع');}function makeTopUpRequest(){const amount=parseFloat($('topupAmount').value)||0;const method=$('topupMethod').value;if(amount<=0||!method) return alert('ادخل المبلغ واختر الطريقة');const order={order:$('topupOrderID').innerText||('SH-'+Date.now()),amount:fmt(amount),method:method,status:'في انتظار',user:currentUser()};const topups=JSON.parse(localStorage.getItem('fast10Topups')||'[]');topups.push(order);localStorage.setItem('fast10Topups',JSON.stringify(topups));const msg=`🔔 طلب شحن جديد\nرقم الطلب: ${order.order}\nالمستخدم: ${order.user}\nالمبلغ: ${order.amount} USDT\nالطريقة: ${order.method}`;window.open(`https://wa.me/${ADMIN_WHATSAPP}?text=${encodeURIComponent(msg)}`,'_blank');alert('تم إنشاء طلب الشحن. أرسل المبلغ للرقم الظاهر وأرسل إثبات الدفع عبر واتساب.');renderTopups();}function renderTopups(){const list=JSON.parse(localStorage.getItem('fast10Topups')||'[]');const el=$('topupList');if(!el) return; if(list.length===0){el.innerHTML='<div>لا توجد طلبات شحن</div>';return;}el.innerHTML=list.map(t=>`<div class="adminItem"><strong>${t.order}</strong> - ${t.amount} USDT - ${t.method} - <em>${t.status}</em></div>`).join('');}function renderOrders(){const list=JSON.parse(localStorage.getItem('fast10Orders')||'[]');const el=$('ordersList');if(!el) return; if(list.length===0){el.innerHTML='<div>لا توجد طلبات</div>';return;}el.innerHTML=list.map(o=>`<div class="adminItem"><strong>${o.id}</strong> - ${o.service} - ${o.qty} - ${o.total}$ - <em>${o.status}</em></div>`).join('');}function renderProfile(){const user=currentUser();if(!user){alert('سجل الدخول');return;}$('profileName').innerText=user;$('profileBal').innerText=fmt(getUserBalance(user));}function showAdminLogin(){document.getElementById('adminLoginSection').style.display='block';}function closeAdminLogin(){document.getElementById('adminLoginSection').style.display='none';}function loginAdmin(){const u=$('adminUser').value.trim(),p=$('adminPass').value.trim();if(u==='admin'&&p==='12345'){window.open('admin.html','_blank');}else alert('بيانات الأدمين خاطئة');}function updateBalancesUI(){const user=currentUser();if(user){$('balanceDisplay').innerText=fmt(getUserBalance(user));$('walletBalance').innerText=fmt(getUserBalance(user));}else{$('balanceDisplay').innerText='0.00';$('walletBalance').innerText='0.00';}renderOrders();renderTopups();}function clearSelections(){document.querySelectorAll('.quantitySelect').forEach(s=>s.value='0');updateAllInvoice();}window.addEventListener('load',()=>{renderServices();updateBalancesUI();});